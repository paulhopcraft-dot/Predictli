import { Router } from 'express'; import { z } from 'zod'; import { db } from '../../db/index.js'; import { match_candidate_job } from '../../db/schema.js'; import { publishEvent } from '../../events/publish.js'; export const matches=Router(); const Create=z.object({ candidate_id:z.string().uuid(), job_id:z.string().uuid(), score:z.number().int().min(0).max(100).default(50) }); matches.post('/', async (req,res)=>{ const p=Create.safeParse(req.body); if(!p.success) return res.status(400).json({error:p.error.flatten()}); const d=p.data; const [m]=await db.insert(match_candidate_job).values({ candidate_id:d.candidate_id, job_id:d.job_id, score:d.score }).returning(); await publishEvent('match.created',{ match_id:m.id }); res.status(201).json({ match_id:m.id }); });
