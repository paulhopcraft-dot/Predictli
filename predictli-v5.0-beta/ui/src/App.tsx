import React,{useEffect,useState} from 'react'
export default function App(){const [t,setT]=useState<string|null>(localStorage.getItem('jwt')||null);const [u,setU]=useState('admin');const [p,setP]=useState('changeme');const h=t?{'Authorization':`Bearer ${t}`}:{} as any;const [s,setS]=useState<any|null>(null);const [e,setE]=useState<any[]>([]);const [r,setR]=useState<any[]>([]);async function load(){const S=await fetch('/api/admin/summary',{headers:h}).then(r=>r.json());setS(S);const E=await fetch('/api/metrics/events-count').then(r=>r.json());setE(E.items||[]);const R=await fetch('/api/matches/recent',{headers:h}).then(r=>r.json());setR(R.items||[]);} useEffect(()=>{if(t) load();},[t]); return (<div style={{fontFamily:'system-ui',margin:20}}><h1>Predictli v5.0 Dashboard</h1>{!t?<div style={{display:'flex',gap:8}}><input placeholder='username' value={u} onChange={e=>setU(e.target.value)}/><input placeholder='password' type='password' value={p} onChange={e=>setP(e.target.value)}/><button onClick={async()=>{const res=await fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})}); if(res.ok){const {token}=await res.json(); localStorage.setItem('jwt',token); setT(token);} else alert('Login failed')}}>Login</button></div>:<><div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:12,marginTop:12}}><Card title='Candidates' value={s?.candidates||0}/><Card title='Open Jobs' value={s?.jobs||0}/><Card title='Matches' value={s?.matches||0}/><Card title='Events' value={s?.events||0}/></div><h2 style={{marginTop:24}}>Recent Matches</h2><table width='100%'><thead><tr><th align='left'>Match ID</th><th align='left'>Job</th><th align='right'>Score</th><th align='left'>When</th></tr></thead><tbody>{r.map((m:any,i:number)=><tr key={i}><td>{m.id}</td><td>{m.job_title}</td><td align='right'>{m.score}</td><td>{new Date(m.created_at).toLocaleString()}</td></tr>)}</tbody></table><h2 style={{marginTop:24}}>Event Metrics</h2><table><thead><tr><th align='left'>Topic</th><th align='right'>Count</th></tr></thead><tbody>{e.map((x:any,i:number)=><tr key={i}><td>{x.topic}</td><td align='right'>{x.cnt}</td></tr>)}</tbody></table></>}</div>)} function Card({title,value}:{title:string;value:number}){return <div style={{border:'1px solid #ddd',borderRadius:12,padding:16}}><div style={{color:'#666',fontSize:12}}>{title}</div><div style={{fontSize:28,fontWeight:700}}>{value}</div></div>}
